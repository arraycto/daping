(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6f418c28"],{"17f3":function(n,t,a){"use strict";a.d(t,"a",(function(){return e}));var e={CREATE:"create",RUNNING:"running",REDRAW:"redraw",RELOAD:"reload",DESTROY:"destroy"}},7031:function(n,t,a){"use strict";var e=a("17f3"),r=a("a553");t["a"]={name:"AbstractComp",mixins:[r["a"]],data:function(){return{chartData:null,nextIndex:0,compDataStatus:"loading",defaultColors:["#04d6ef","#ef58ea","#ff9e87","#0cc2ff","#fad860","#9bca63","#fe8463","#975fe5","#dc81d2","#8d98b3"]}},watch:{compDataStatus:{handler:function(n){"loading"===n&&this.chartLoading()}}},methods:{draw:function(){},chartLoading:function(){this.myChart&&this.myChart.showLoading({text:"",color:"#666",textColor:"#fff",maskColor:"rgba(115, 170, 229, 0)",zlevel:0,fontSize:30,showSpinner:!0,spinnerRadius:10,lineWidth:5})},_toggleCompShow:function(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments.length>2?arguments[2]:void 0;n&&(document.getElementById("".concat(a)).style.transition=t?"all .3s ease-out":"",document.getElementById("".concat(a)).style.transform=t?"scale(1)":"scale(0)")}},created:function(){this.updateState(e["a"].CREATE)},mounted:function(){var n=this;this.updateChartData(this.compData),this.draw(),this.updateState(e["a"].RUNNING),this.$nextTick((function(){n.linkageConfChanged()}))},destroyed:function(){this.updateState(e["a"].DESTROY)},render:function(n){var t=this.compConf.compId;return n("div",{attrs:{id:t},style:{left:"0px",top:"0px",width:"100%",height:"100%",position:"absolute"}})}}},"98f2":function(n,t,a){var e=a("1f17"),r=e("match");n.exports=function(n){var t=/./;try{"/./"[n](t)}catch(a){try{return t[r]=!1,"/./"[n](t)}catch(e){}}return!1}},a553:function(n,t,a){"use strict";a("72b3"),a("c726"),a("a543"),a("a866"),a("cca2"),a("6540"),a("dede"),a("1d7a"),a("b5eb"),a("0bd5"),a("b784"),a("9b42"),a("270f");var e=a("d211"),r=a("17f3"),o=a("cf6b"),i=a("0e0b");t["a"]={name:"ComInterface",props:["compConf"],data:function(){return{chartData:null,compDataStatus:"loading"}},computed:Object(e["a"])({compId:function(){return this.compConf.compId},box:function(){return this.compConf.box},styleConf:function(){return this.compConf.style},dataConf:function(){if(this.compConf.data)return this.compConf.data.conf},dataSourceConf:function(){if(this.compConf.data)return this.compConf.data.datasource},compData:function(){return this.$store.state.compData.compData[this.compId]},linkageConf:function(){return this.compConf.linkage},state:function(){return this.compConf.state}},Object(o["c"])({activeCompData:"getCompData"})),watch:{styleConf:{handler:function(n,t){this.updateState(r["a"].REDRAW),this.styleConfChanged(n,t),this.updateState(r["a"].RUNNING)},deep:!0},state:{handler:function(n,t){},deep:!0},compData:{handler:function(n,t){n&&JSON.stringify(n)!=JSON.stringify(t)&&this.updateCompData(!0)},deep:!0},linkageConf:{handler:function(n,t){this.linkageConfChanged(n,t)},deep:!0},"dataSourceConf.type":{handler:function(n,t){this.$evtBus.destroy(this.compId)}}},methods:{convertExpression:function(n){if(-1!==JSON.stringify(n).indexOf("${")){var t=JSON.stringify(n);n=this._getExpressionValue(t),n=JSON.parse(n)}return n},styleConfChanged:function(){},compDataChanged:function(){},resize:function(){},convertChartData:function(n){},linkageConfChanged:function(n,t){},updateState:function(n){this.$emit("compState",n)},updateChartData:function(n){this.chartData=this.convertChartData(n)||n},_linkageDataKeys:function(n){var t=[];for(var a in n)n[a].data.forEach((function(n){t.push({bindMapperColumn:n.bindMapperColumn,value:n.value,operationType:n.operationType})}));return t},_getColumnCondition:function(n,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(1===n.useType)return{bindMapperColumn:n.columnName,dsId:t,operationType:n.operationType,value:n.value};if(2===n.useType){if(!a.length)return{};var e=this._getGlobalParamsValue(n.columnName,a);return e?{bindMapperColumn:n.columnName,dsId:t,operationType:n.operationType,value:e}:{}}n.value;var r=this._getExpressionValue(n.value);return r&&-1===r.indexOf("${")&&-1===r.indexOf("}")?{bindMapperColumn:n.columnName,dsId:t,operationType:n.operationType,value:r}:{}},_mergeElementConfig:function(n,t,a){var e=this,r=t.data.conf[n],o=_.cloneDeep(r.searchElementConfigs)||[];if(o.length){var i=a.state.window.globalParams;o.sort((function(n,t){return n.useType-t.useType}));var c={};o.forEach((function(t){var a=e._getColumnCondition(t,n,i);_.isEmpty(a)||(c[t.columnName]=a)})),_.isEmpty(c)||(o=Object.values(c))}var u=a.getters.getLinkagesByCompId(t["compId"]);if(_.isEmpty(u))return o;var s=o.map((function(n){return n.bindMapperColumn}))||[],f=this._linkageDataKeys(u);return f.forEach((function(t,a){var e=s.indexOf(t.bindMapperColumn);-1!==e?(o[a]["value"]=t.value,o[a].operationType=t.operationType):o.push({dsId:n,bindMapperColumn:t.bindMapperColumn,value:t.value,operationType:t.operationType})})),o},_checkRequireFields:function(){var n=this.compConf;if("dataset"===n.data.datasource.type){var t=n.data.conf.datasetSelectedIds;if(t&&Array.isArray(t)&&t.length){var a=n.data.conf.datasetSelectedIds[0],e=n.data.conf[a]["requireFields"];if(!e||!e.length)return!0;var r=this._mergeElementConfig(a,n,this.$store);if(!r.length)return!1;var o=r.map((function(n){return n.bindMapperColumn})),i=0;return e.forEach((function(n){-1!==o.indexOf(n)&&i++})),i===e.length}}return!0},updateCompData:function(n){if(n)this.compDataStatus="loaded",this.updateState(r["a"].RELOAD),this.compData&&(this.updateChartData(this.compData),this.compDataChanged(),this.updateState(r["a"].RUNNING));else if(["dataset"].includes(this.compConf.data.datasource.type)){var t=this._checkRequireFields();if(!t)return;var a=this.$dm._getFormatRequestParams(this.compConf),e=this.$store.getters.getConditionsByCompId(this.compConf.compId);(!this.$store.getters.getPreviewState||e.length<1||JSON.stringify(e[0].groupByConfig)!==JSON.stringify(a[0].groupByConfig)||JSON.stringify(e[0].orderByConfigDTO)!==JSON.stringify(a[0].orderByConfigDTO)||JSON.stringify(e[0].searchElementConfigs)!==JSON.stringify(a[0].searchElementConfigs))&&(this.compDataStatus="loading",this.$dm.initCompData(this.compConf))}else this.$dm.initCompData(this.compConf)},_mergeArr:function(){for(var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=[],e=n.length>t.length?n.length:t.length,r=0;r<e;r++){var o=n[r]?n[r]:t[r];a.push(o)}return a},_showNoDataBox:function(n){var t=document.getElementById("".concat(n)).querySelector("".concat(n,"_no_data_box"));if(!t){var a=document.createElement("div");a.id="".concat(n,"_no_data_box"),a.innerHTML="无数据",document.getElementById("".concat(n)).appendChild(a)}},_handleStaticData:function(){},_handleConditionExpression:function(){},_getCompLinkageParamsValue:function(n,t){var a=this.$store.getters.getLinkagesByCompId(t);if(!a)return null;if(a=a[n[0]],!a)return null;if(a=a["sourceData"],!a)return null;for(var e=1;e<n.length;e++){if(!a[n[e]])return null;a=a[n[e]]}return a},_getGlobalParamsValue:function(n){var t=this.$store.state.window.globalParams;if(!t||!t.length)return null;for(var a=0;a<t.length;a++)if(t[a].name===n)return t[a].value?t[a].value:null;return null},_getExpressionValue:function(n){var t=this,a=i["a"].getCustomExpressionParams(n),e=[];return a&&a.length&&a.forEach((function(n){var a=i["a"].getCustomExpressionCloumn(n),r=a.exp,o=a.format||"${"+r.join(".")+"}";if(r.length>=2)if("global"===r[0]){var c=t._getGlobalParamsValue(r[1]);c?e.push(c):e.push(o)}else{var u=t._getCompLinkageParamsValue(r,t.compConf["compId"]);u?e.push(u):e.push(o)}else e.push(o)})),e.length&&a.forEach((function(t,a){n=n.replace(t,e[a])})),n},_convertEventOutData:function(n,t){if(!t||!t.datasource||"static"===t.datasource.type)return n;var a=t.conf[t.conf.datasetSelectedIds[0]]["datasetMeta"],e=_.cloneDeep(n);if(_.isObject(n)){var r=function(t){a.forEach((function(a){[a.columnDesc,a.columnName].includes(t)&&a.columnDesc&&(e[a.columnDesc]=n[t],e[a.columnName]=n[t])}))};for(var o in n)r(o);return e}return _.isArray(n)?(n.forEach((function(t,r){var o=function(o){a.forEach((function(a){[a.columnDesc,a.columnName].includes(o)&&a.columnDesc&&(e[r][a.columnDesc]=n[t][o],e[r][a.columnName]=n[t][o])}))};for(var i in n[t])o(i)})),e):e}}}},b203:function(n,t,a){var e=a("00a5");n.exports=function(n){if(e(n))throw TypeError("The method doesn't accept regular expressions");return n}},b784:function(n,t,a){"use strict";var e=a("a09b"),r=a("b203"),o=a("4340"),i=a("98f2");e({target:"String",proto:!0,forced:!i("includes")},{includes:function(n){return!!~String(o(this)).indexOf(r(n),arguments.length>1?arguments[1]:void 0)}})},ee5d:function(n,t,a){"use strict";a.d(t,"a",(function(){return I})),a.d(t,"b",(function(){return O})),a.d(t,"g",(function(){return l})),a.d(t,"h",(function(){return h})),a.d(t,"e",(function(){return g})),a.d(t,"f",(function(){return A})),a.d(t,"i",(function(){return T})),a.d(t,"c",(function(){return R})),a.d(t,"d",(function(){return B}));a("445a"),a("cb3c"),a("72b3"),a("cb91"),a("c726"),a("6540"),a("dede"),a("fae2"),a("402f"),a("b5eb"),a("a5932"),a("36e5"),a("b784"),a("2db5"),a("270f"),a("6ab7");var e=a("4c09"),r=(a("a543"),a("1d7a"),function(n){var t={};return n.forEach((function(n){return t[n.columnName]=n})),t}),o=function(n,t){var a={dimensions:0,indi:0};return n?(n.forEach((function(n){return 1==t[n]["columnDefDire"]?a.indi++:a.dimensions++})),a):a},i=function(n,t){var a=r(n),e={dimensions:[],indi:[]};return t.forEach((function(n){return 1==a[n]["columnDefDire"]?e.indi.push(a[n]["columnName"]):e.dimensions.push(a[n]["columnName"])})),e},c=function(n,t,a){var e=null;a||(a="legend"),n.forEach((function(n){a==n.name&&(e=n)})),e?e.data.push(t):(e={name:a||"legend",data:[t]},n.push(e))},u=function(n,t){-1==n.indexOf(t)&&n.push(t)},s=function(n){var t={};return n.forEach((function(n){return t[n.columnName]=n})),t},f=function(n){for(var t=0;t<n.length;t++)if(2===n[t].columnDefDire)return n[t].columnName;return""},d=function(n,t,a){var e=s(t),r=[];a.forEach((function(n){1==e[n]["columnDefDire"]&&r.push(n)}));var o=f(t),i={};for(var c in n&&n.length&&n.forEach((function(n){i[n[o]]||(i[n[o]]={}),r.forEach((function(t){i[n[o]][t]||(i[n[o]][t]=0),i[n[o]][t]+=n[t]}))})),r.forEach((function(n,t){e[n]["columnDesc"]&&(r[t]={name:e[n]["columnDesc"]})})),i)i[c]=Object.values(i[c]);return{indicator:r,seriesData:i}},l=d,m=function(n,t){if(0==n.length)return{name:"",value:0};var a=n[0];return{name:a[t.name],value:a[t.value]}},h=m,p=function(n,t){if(0==n.length)return{name:"",value:0};var a=n[0];return{value:a[t.value]}},g=p,v=a("28f8"),y=a("d211"),C=function(n,t,a,e){r(e);var o=[];return n&&n.forEach((function(n){o.push(Object(y["a"])(Object(v["a"])({},"".concat(a),n[a]),n))})),o},D=function(n,t,a,e){var r=i(e,t),o=r["dimensions"][0],c={};n.forEach((function(n){c[n[o]]=n[o]}));var u=[];for(var s in c){var f;u.push((f={},Object(v["a"])(f,"".concat(a),s),Object(v["a"])(f,"value",c[s]),Object(v["a"])(f,"sourceName",o),f))}return u},E=a("a14a"),x=a.n(E),b=function(n,t){var a={classify:[],legends:[]};return n.forEach((function(n,e,r){u(a.classify,n[t.classify]),c(a.legends,n[t.value],n[t.legend])})),a},S=function(){return{classify:[],data:[]}},N=function(n,t){var a=t.xAxisIds,e=r(t.datasetMeta),i=o(a,e),c={};if(i.dimensions>=1&&i.indi>=1){var u=[],s=[];a.forEach((function(n){return 1==e[n]["columnDefDire"]?s.push(n):u.push(n)}));var f=u[0],d=s[0];return n.forEach((function(n){c[n[f]]||(c[n[f]]=0),c[n[f]]+=parseFloat(n[d])})),[c]}return 0===i.dimensions?(n.forEach((function(n){a.forEach((function(t){var a=e[t]["columnDesc"]?e[t]["columnDesc"]:t;c[a]||(c[a]=0),c[a]+=n[t]||0}))})),[c]):[]},I=function(n,t){return n&&t?b(n,t):(console.warn("cannot parse data with getColumnData"),S())},O=function(n,t){return n&&t?N(n,t):(console.warn("cannot parse data with getColumnData"),{dataSource:[],dimensions:""})},_=function(n,t){var a,e=r(t.datasetMeta),o=t.xAxisIds.concat(t.yAxisIds),i=new Set,c={},u=[];o.forEach((function(n){return 1==e[n]["columnDefDire"]?u.push(n):a=n})),i.add(a),u.forEach((function(n){return i.add(n)}));var s=new Set;n.forEach((function(n){return s.add(n[a])})),s=Array.from(s);var f=Array.from(i);n.forEach((function(n){var t="dimension"+n[a];c[t]||(c[t]={}),f.forEach((function(r){var o=e[r]["columnDesc"]?e[r]["columnDesc"]:e[r]["columnName"];c[t][o]||(c[t][o]=0),r!==a?c[t][o]+=parseFloat(n[r])||0:c[t][o]=parseFloat(n[r])}))}));for(var d=0;d<f.length;d++)f[d]=e[f[d]]["columnDesc"]?e[f[d]]["columnDesc"]:e[f[d]]["columnName"];return{dataSource:Object.values(c),dimensions:f}},w=function(n,t){var a=r(t.datasetMeta),e=!1;if(t.xAxisIds.length)for(var o=0;o<t.xAxisIds.length;o++)if(1==a[t.xAxisIds[o]]["columnDefDire"]){e=!0;break}var i=t.xAxisIds.concat(t.yAxisIds),c=x.a.cloneDeep(i),u={};n.forEach((function(n){c.forEach((function(t){var e=a[t]["columnDesc"];u[e]||(u[e]=0),u[e]+=parseFloat(n[t])||0}))}));for(var s=0;s<c.length;s++)c[s]=a[c[s]]["columnDesc"];return e||(u["_product$_"]="",c.unshift("_product$_")),{dimensions:c,dataSource:[u]}},A=function(n,t){var a=t.xAxisIds.concat(t.yAxisIds),e=r(t.datasetMeta),i=o(a,e);if(1===i.dimensions&&i.indi>=1)return _(n,t);if(0===i.dimensions)return w(n,t);var c=[],u=new Set,s=[],f={};t.xAxisIds.concat(t.yAxisIds).forEach((function(t){1==e[t]["columnDefDire"]?c.push(t):(f[t]=new Set,n.forEach((function(n){f[t].add(n[t])})))}));var d=Object.keys(f),l="";return d.forEach((function(n){t.xAxisIds.concat(t.yAxisIds).includes(n)&&(l=n)})),u.add(l),f[l].forEach((function(t){var a={};if(a[l]=t,d.forEach((function(e){e!==l&&f[e].forEach((function(r){u.add(r);var o=0;c.forEach((function(a){n.forEach((function(n){n[e]===r&&n[l]===t&&(o+=parseFloat(n[a])||0)}))})),a[t]||(a[t]=0),a[t]+=o,a[r]||(a[r]=0),a[r]+=o}))})),1===d.length){u.add(t);var e=0;c.forEach((function(a){n.forEach((function(n){n[l]===t&&(e+=parseFloat(n[a])||0)}))})),a[t]||(a[t]=0),a[t]+=e}s.push(a)})),{dataSource:s,dimensions:Array.from(u)}},T=function(n,t,a){var e=t.xAxisIds,i=r(t.datasetMeta),c=o(e,i);return c.dimensions?D(n,e,a,t.datasetMeta):C(n,e,a,t.datasetMeta)},k=function(n,t,a){var e={data:[[]],axisData:[],indi:t,categoryName:[]};return n.forEach((function(n){e.axisData.push(n[a]),e.data[0].push([n[t[0]],n[t[1]],n[t[2]],n[t[3]],n[t[4]]])})),e},M=function(n,t,a){var e={data:[],axisData:[],indi:t,categoryName:[]},r=a[0],o=a[1],i={},c=new Set;n.forEach((function(n){c.add(n[r]),i[n[o]]||(i[n[o]]=[]),i[n[o]].push(n)})),c=Array.from(c),e.axisData=c;var u=0;for(var s in i)e.categoryName.push(s),e.data[u]||(e.data[u]=[]),e.data[u]=[],e.data[u]=i[s].map((function(n){return[n[t[0]],n[t[1]],n[t[2]],n[t[3]],n[t[4]]]})),u++;return e},R=function(n,t,a){var e=r(a),o=t.filter((function(n){return 1==e[n]["columnDefDire"]}));if(5!==o.length)return{axisData:[],data:[],category:!1};var i=t.filter((function(n){return 2==e[n]["columnDefDire"]}));return 1===i.length?k(n,o,i[0]):i.length>=2?M(n,o,i):0===i.length?{axisData:[],data:n.map((function(n){return[n[o[0]],n[o[1]],n[o[2]],n[o[3]],n[o[4]]]})),indi:o,categoryName:[]}:void 0},j=function(n,t,a){var r=a.length,o={keys:[t].concat(Object(e["a"])(a)),data:[[]],min:0,max:0,categoryName:[],symbolIndex:r};return n.forEach((function(n){o.min=Math.min(o.min,n[a[r]]),o.max=Math.max(o.max,n[a[r]]);var i=a.map((function(t){return n[t]}));o.data[0].push([n[t]].concat(Object(e["a"])(i)))})),o},$=function(n,t,a,r){var o={keys:[t].concat(Object(e["a"])(a),[r[0]]),data:[],min:0,max:0,categoryName:[],symbolIndex:a.length>1?2:1},i=r[0],c=t,u=(a[0],{}),s=a[o.symbolIndex-1];console.log(s),n.forEach((function(n){var t=parseFloat(n[s]);o.min=Math.min(o.min,t),o.max=Math.max(o.max,t),u[n[i]]||(u[n[i]]=[]),u[n[i]].push(n)}));var f=0;for(var d in u)o.categoryName.push(d),o.data[f]||(o.data[f]=[]),o.data[f]=[],o.data[f]=u[d].map((function(n){var t=a.map((function(t){return n[t]}));return[n[c]].concat(Object(e["a"])(t),[n[i]])})),f++;return o},B=function(n,t,a){var e=t.x,o=t.y;if(!e.length)return{data:[]};var i=r(a),c=o.filter((function(n){return 2==i[n]["columnDefDire"]})),u=o.filter((function(n){return 1==i[n]["columnDefDire"]}));return c.length>=1?$(n,e[0],u,c):j(n,e[0],o)}}}]);